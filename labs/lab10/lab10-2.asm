section .data
    ; Сообщения
    prompt      db "Как вас зовут (имя фамилия)? ", 0
    prompt_len  equ $ - prompt
    
    prefix      db "Меня зовут: ", 0
    prefix_len  equ $ - prefix
    
    success_msg db "Данные записаны в файл name.txt", 10, 0
    success_len equ $ - success_msg
    
    error_msg   db "Ошибка при создании файла!", 10, 0
    error_len   equ $ - error_msg
    
    newline     db 10
    filename    db "name.txt", 0
    
section .bss
    buffer      resb 256        ; буфер для ввода имени
    name_len    resd 1          ; длина имени (32 бита)
    fd          resd 1          ; файловый дескриптор (32 бита)
    
section .text
    global _start

_start:
    ; ===========================================
    ; Шаг 1: Запрашиваем имя пользователя
    ; ===========================================
    mov eax, 4          ; sys_write
    mov ebx, 1          ; stdout
    mov ecx, prompt
    mov edx, prompt_len
    int 0x80
    
    ; ===========================================
    ; Шаг 2: Читаем имя с клавиатуры
    ; ===========================================
    mov eax, 3          ; sys_read
    mov ebx, 0          ; stdin
    mov ecx, buffer
    mov edx, 256
    int 0x80
    
    ; Сохраняем длину имени (без символа новой строки)
    dec eax
    mov [name_len], eax
    
    ; ===========================================
    ; Шаг 3: Создаем файл name.txt
    ; ===========================================
    mov eax, 8          ; sys_creat (создание файла)
    mov ebx, filename   ; имя файла
    mov ecx, 0o644      ; права доступа: rw-r--r--
    int 0x80
    
    cmp eax, 0
    jl file_error       ; если ошибка при создании файла
    
    ; Сохраняем файловый дескриптор
    mov [fd], eax
    
    ; ===========================================
    ; Шаг 4: Записываем "Меня зовут: " в файл
    ; ===========================================
    mov eax, 4          ; sys_write
    mov ebx, [fd]       ; файловый дескриптор
    mov ecx, prefix
    mov edx, prefix_len
    int 0x80
    
    ; ===========================================
    ; Шаг 5: Записываем имя в файл
    ; ===========================================
    mov eax, 4          ; sys_write
    mov ebx, [fd]
    mov ecx, buffer
    mov edx, [name_len]
    int 0x80
    
    ; ===========================================
    ; Шаг 6: Добавляем перенос строки
    ; ===========================================
    mov eax, 4          ; sys_write
    mov ebx, [fd]
    mov ecx, newline
    mov edx, 1
    int 0x80
    
    ; ===========================================
    ; Шаг 7: Закрываем файл
    ; ===========================================
    mov eax, 6          ; sys_close
    mov ebx, [fd]
    int 0x80
    
    ; ===========================================
    ; Шаг 8: Выводим сообщение об успехе
    ; ===========================================
    mov eax, 4
    mov ebx, 1
    mov ecx, success_msg
    mov edx, success_len
    int 0x80
    
    ; ===========================================
    ; Шаг 9: Завершаем программу
    ; ===========================================
    jmp exit_program

; ===========================================
; Обработка ошибки файла
; ===========================================
file_error:
    mov eax, 4
    mov ebx, 1
    mov ecx, error_msg
    mov edx, error_len
    int 0x80

; ===========================================
; Завершение программы
; ===========================================
exit_program:
    mov eax, 1          ; sys_exit
    mov ebx, 0          ; код возврата 0
    int 0x80
